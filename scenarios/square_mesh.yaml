# Toy scenario: 4-node full mesh topology with single-link failure analysis
# Each node connected to every other node with identical link parameters

seed: 42

network:
  nodes:
    N1: {}
    N2: {}
    N3: {}
    N4: {}

  links:
    # Full mesh connectivity: 6 bidirectional links (connects every node to every other node)
    # Links are bidirectional by default in NetGraph
    - source: N1
      target: N2
      link_params:
        capacity: 2.0
        cost: 1.0
    - source: N1
      target: N3
      link_params:
        capacity: 1.0
        cost: 1.0
    - source: N1
      target: N4
      link_params:
        capacity: 2.0
        cost: 1.0
    - source: N2
      target: N3
      link_params:
        capacity: 2.0
        cost: 1.0
    - source: N2
      target: N4
      link_params:
        capacity: 1.0
        cost: 1.0
    - source: N3
      target: N4
      link_params:
        capacity: 2.0
        cost: 1.0

failure_policy_set:
  single_link_failure:
    modes:
      - weight: 1.0
        rules:
          - entity_scope: link
            rule_type: choice
            count: 1

traffic_matrix_set:
  baseline_traffic_matrix:
    - source_path: "^N([1-4])$"
      sink_path: "^N([1-4])$"
      demand: 12.0
      mode: "pairwise"
      attrs:
        euclidean_km: 10

workflow:
  # 1) Maximum Supported Demand search
  - step_type: MaximumSupportedDemand
    name: msd_baseline
    matrix_name: baseline_traffic_matrix
    acceptance_rule: hard
    alpha_start: 1.0
    growth_factor: 2.0
    alpha_min: 0.001
    alpha_max: 1000000.0
    resolution: 0.05
    max_bracket_iters: 16
    max_bisect_iters: 32
    seeds_per_alpha: 1
    placement_rounds: 2

  # 2) Traffic matrix placement using MSD alpha
  - step_type: TrafficMatrixPlacement
    name: tm_placement
    matrix_name: baseline_traffic_matrix
    failure_policy: single_link_failure
    iterations: 1000
    parallelism: 8
    placement_rounds: auto
    baseline: true
    seed: 42
    store_failure_patterns: true
    include_flow_details: true
    alpha_from_step: msd_baseline
    alpha_from_field: data.alpha_star

  # 3) MaxFlow capacity matrix between all node pairs
  - step_type: MaxFlow
    name: node_to_node_capacity_matrix
    source_path: "^(N[1-4])$"
    sink_path: "^(N[1-4])$"
    mode: pairwise
    failure_policy: single_link_failure
    iterations: 1000
    parallelism: 8
    shortest_path: false
    flow_placement: PROPORTIONAL
    baseline: true
    seed: 42
    store_failure_patterns: true
    include_flow_details: true
    include_min_cut: true
